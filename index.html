<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1>PG::AWS_RDS_IAM</h1>
<p><a href="https://rubygems.org/gems/pg-aws_rds_iam"><img src="https://img.shields.io/gem/v/pg-aws_rds_iam?style=flat-square" alt="Gem" /></a>
â€‚
<a href="https://haines.github.io/pg-aws_rds_iam/"><img src="https://img.shields.io/badge/yard-docs-blue?style=flat-square" alt="Docs" /></a></p>
<p><code>PG::AWS_RDS_IAM</code> is a plugin for the <a href="https://rubygems.org/gems/pg"><code>pg</code> gem</a> that adds support for <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.html">IAM authentication</a> when connecting to PostgreSQL databases hosted in Amazon RDS.</p>
<p>IAM authentication allows your application to connect to the database using secure, short-lived authentication tokens instead of a fixed password.
This gives you greater security and eliminates the operational overhead of rotating passwords.</p>
<h2>Installation</h2>
<p>Install manually:</p>
<pre class="code console"><code class="console">$ gem install pg-aws_rds_iam
</code></pre>
<p>or with Bundler:</p>
<pre class="code console"><code class="console">$ bundle add pg-aws_rds_iam
</code></pre>
<h2>Usage</h2>
<p>To use IAM authentication for your database connections, you need to</p>
<ol>
<li>enable IAM authentication for your database,</li>
<li>provide your application with IAM credentials, and</li>
<li>configure your application to generate authentication tokens.</li>
</ol>
<h3>1. Enable IAM authentication for your database</h3>
<p>Start by configuring your database to allow IAM authentication using either the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.Enabling.html#UsingWithRDS.IAMDBAuth.Enabling.Console">AWS console</a> or the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.Enabling.html#UsingWithRDS.IAMDBAuth.Enabling.CLI"><code>aws</code> CLI</a>.
This doesn't require downtime so is safe to apply immediately, unless you already have pending modifications that require a database reboot.</p>
<p>Next, <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.DBAccounts.html#UsingWithRDS.IAMDBAuth.DBAccounts.PostgreSQL">grant your database user the <code>rds_iam</code> role</a>.</p>
<h3>2. Provide your application with IAM credentials</h3>
<p>The most secure way to grant your application permission to connect to your database is to use an IAM role.</p>
<p>Start by <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html">creating a service role</a> if your application doesn't already have one.
Then, create an <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.IAMPolicy.html">IAM policy granting the <code>rds-db:connect</code> permission</a> and attach it to the role.</p>
<p>If you've created a new service role, you'll need to associate it with your application.
The way to do this depends on where you are running your application:</p>
<ul>
<li>for EC2 instances, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html">set up an instance profile</a>;</li>
<li>for EKS pods, <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html">associate the IAM role with a Kubernetes service account</a>;</li>
<li>for ECS tasks, <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html">configure a task role</a>; or</li>
<li>for Lambda functions, <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html">set the execution role</a>.</li>
</ul>
<p>If you can't use a service role, then you can grant the permissions to an IAM user instead and supply the application with their access key through a <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">configuration profile</a> or via the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables.
However, you won't get the full security and operational benefits of RDS IAM authentication, because the access key is a long-lived secret that you need to supply to the application securely and rotate periodically.</p>
<h3>3. Configure your application to generate authentication tokens</h3>
<p>You can use <code>PG::AWS_RDS_IAM</code>'s default authentication token generator if you are using a service role as described above, or if you configure your application using the standard AWS ways to provide <a href="https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/setup-config.html#aws-ruby-sdk-setting-credentials">credentials</a> and <a href="https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/setup-config.html#aws-ruby-sdk-setting-region">region</a>.</p>
<p>To use the default authentication token generator, set the <code>aws_rds_iam_auth_token_generator</code> connection parameter to <code>default</code>.
You can set this parameter in</p>
<ul>
<li>
<p>the query string of a connection URI:</p>
<pre class="code ruby"><code class="ruby">postgresql://andrew@postgresql.example.com:5432/blog?aws_rds_iam_auth_token_generator=default
</code></pre>
</li>
<li>
<p>a <code>key=value</code> pair in a connection string:</p>
<pre class="code ruby"><code class="ruby">user=andrew host=postgresql.example.com port=5432 dbname=blog aws_rds_iam_auth_token_generator=default
</code></pre>
</li>
<li>
<p>a <code>key: value</code> pair in a connection hash:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="PG.html" title="PG (module)">PG</a></span></span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span>
  <span class='label'>user:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>andrew</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>postgresql.example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>port:</span> <span class='int'>5432</span><span class='comma'>,</span>
  <span class='label'>dbname:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blog</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>aws_rds_iam_auth_token_generator:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>default</span><span class='tstring_end'>&quot;</span></span>
<span class='rparen'>)</span>
</code></pre>
</li>
<li>
<p><code>database.yml</code>, if you're using Rails:</p>
<pre class="code yaml"><code class="yaml">production:
  adapter: postgresql
  username: andrew
  host: postgresql.example.com
  port: 5432
  database: blog
  aws_rds_iam_auth_token_generator: default
</code></pre>
</li>
</ul>
<p>If the default authentication token generator doesn't meet your needs, you can register an alternative with</p>
<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="PG.html" title="PG (module)">PG</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="PG/AWS_RDS_IAM.html" title="PG::AWS_RDS_IAM (module)">AWS_RDS_IAM</a></span></span><span class='period'>.</span><span class='id identifier rubyid_auth_token_generators'><span class='object_link'><a href="PG/AWS_RDS_IAM.html#auth_token_generators-class_method" title="PG::AWS_RDS_IAM.auth_token_generators (method)">auth_token_generators</a></span></span><span class='period'>.</span><span class='id identifier rubyid_add'><span class='object_link'><a href="PG/AWS_RDS_IAM/AuthTokenGeneratorRegistry.html#add-instance_method" title="PG::AWS_RDS_IAM::AuthTokenGeneratorRegistry#add (method)">add</a></span></span> <span class='symbol'>:custom</span> <span class='kw'>do</span>
  <span class='const'><span class='object_link'><a href="PG.html" title="PG (module)">PG</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="PG/AWS_RDS_IAM.html" title="PG::AWS_RDS_IAM (module)">AWS_RDS_IAM</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="PG/AWS_RDS_IAM/AuthTokenGenerator.html" title="PG::AWS_RDS_IAM::AuthTokenGenerator (class)">AuthTokenGenerator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="PG/AWS_RDS_IAM/AuthTokenGenerator.html#initialize-instance_method" title="PG::AWS_RDS_IAM::AuthTokenGenerator#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>credentials:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>region:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>
<p>To use this alternative authentication token generator, set the <code>aws_rds_iam_auth_token_generator</code> connection parameter to the name you registered it with (<code>custom</code>, in this example).</p>
<p>The block you give to <code>add</code> must construct and return the authentication token generator, which can either be an instance of <code>PG::AWS_RDS_IAM::AuthTokenGenerator</code> or another object that returns a string token in response to <code>call(host:, port:, user:)</code>.
The block will be called once, when the first token is generated, and the returned authentication token generator will be re-used to generate all future tokens.</p>
<h2>Development</h2>
<p>After checking out the repo, run <code>bin/setup</code> to install dependencies.
Then, run <code>bin/rake</code> to run the tests.
You can also run <code>bin/console</code> for an interactive prompt that will allow you to experiment.</p>
<p>To install this gem onto your local machine, run <code>bin/rake install</code>.
To release a new version, update the version number in <code>version.rb</code>, and then run <code>bin/rake release</code>, which will create a git tag for the version, push git commits and tags, and push the <code>.gem</code> file to <a href="https://rubygems.org">rubygems.org</a>.</p>
<h2>Contributing</h2>
<p>Bug reports and pull requests are welcome <a href="https://github.com/haines/pg-aws_rds_iam">on GitHub</a>.
This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the <a href="https://github.com/haines/pg-aws_rds_iam/blob/main/CODE_OF_CONDUCT.md">code of conduct</a>.</p>
<h2>License</h2>
<p>The gem is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
</div></div>

      <div id="footer">
  Generated on Wed Jun 22 20:00:36 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>